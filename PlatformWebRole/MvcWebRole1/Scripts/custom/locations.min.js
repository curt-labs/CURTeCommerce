var map,markers,locations,infoWindow,geocoder,directionsDisplay,directionsService;directionsService=new google.maps.DirectionsService;$(function(){var e=function(){var e=$("#mid_col").width(),d=$("#mid_col").height();$("#mid_col").css("position","relative");var a=document.createElement("div");$(a).addClass("loader").css("background","white").css("z-index","2000").css("position","absolute").css("top","0").css("left","0").css("height",d).css("width",e).css("opacity","0.8").css("text-align","center");var c=document.createElement("img");$(c).attr("src","/Content/img/159.gif").css("width","175px").css("display","block").css("margin","60px auto 10px auto");$(a).append(c);var b=document.createElement("span");$(b).css("font-size","22px").text("Calculating your location...");$(a).append(b);$("#mid_col").append(a)},g=function(){$("div.loader").fadeOut(400,function(){$(this).remove()})},b=function(d,a,c){var b={center:new google.maps.LatLng(d,a),zoom:c,mapTypeId:google.maps.MapTypeId.ROADMAP};map=new google.maps.Map(document.getElementById("map"),b);$("#map").show();directionsDisplay.setMap(map);f()},f=function(){markers=[];infoWindows=[];for(i=0;i<locations.length;i++){var b=new google.maps.Marker({position:new google.maps.LatLng(locations[i].latitude,locations[i].longitude),map:map,title:locations[i].name,animation:google.maps.Animation.DROP});markers[i]=b;google.maps.event.addListener(b,"click",function(){infoWindow&&infoWindow.close();var b=$.inArray(this,markers);infoWindow=new google.maps.InfoWindow({content:a(b)});infoWindow.open(map,markers[b])})}},a=function(c){var b=locations[c];if(b!=undefined){var a='<div class="infoWindow">';a+='<span class="title">'+b.name+"</span>";a+='<span class="directions_easy" data-address="'+b.address+" "+b.city+","+b.state+'"  data-lat="'+b.latitude+'" data-long="'+b.longitude+'">';a+='<img src="/Content/img/directions.jpg" alt="Get Directions" />';a+="Get Directions</span>";if(b.phone!=undefined){a+="<span>";a+='<img src="/Content/img/phone-icon.png" alt="Phone: '+b.phone+'">';a+="Phone: "+b.phone;a+="</span>"}if(b.fax!=undefined){a+="<span>";a+='<img src="/Content/img/Fax.png" alt="Fax: '+b.fax+'">';a+="Fax: "+b.fax;a+="</span>"}if(b.email!=undefined){a+='<span class="send_email" data-email="'+b.email+'">';a+='<img src="/Content/img/footer/mail.png" alt="E-Mail: '+b.email+'">';a+="E-Mail: "+b.email;a+="</span>"}a+="</div>"}return a},c=function(a){e();$.post("/Locations/GetNearest",{lat:a.coords.latitude,lon:a.coords.longitude},function(a){if(a.length==0)b(locations[0].latitude,locations[0].longitude,4);else $.each(a,function(c,a){var b=$("#"+a.locationID).clone().wrap("<div>").parent().html();$("#"+a.locationID).remove();if(c===0){map.panTo(new google.maps.LatLng(a.latitude,a.longitude));g();map.setZoom(9)}$(".location").last().after(b.toString()).show()})},"json")},d=function(a){$.getJSON("/GlobalFunctions/GetCountries",function(c){if(c!==undefined&&c.length>0){var b;b='<link href="/Content/css/share-email.css" media="all" rel="stylesheet" />';b+='<span class="share-heading">Enter your address for a start location.</span>';b+='<form class="share-form">';b+='<input type="hidden" id="destination" value="'+a+'" />';b+='<label for="addr">Address';b+='<input type="text" id="directAddr" placeholder="Enter your address..." /></label>';b+='<label for="city">City';b+='<input type="text" id="city" placeholder="Enter your city..." /></label>';b+='<label for="state">State';b+='<select id="state">';$.each(c,function(c,a){b+='<optgroup label="'+a.name+'">';$.each(a.states,function(c,a){b+='<option value="'+a.abbr+'">'+a.state+"</option>"});b+="</optgroup>"});b+="</select>";b+="</label>";b+='<div class="clearfix"></div>';b+='<input type="submit" id="getDirections" value="Get Directions" style="display:inline-block" />';b+='<a href="javascript:$.modal.close()" title="Close" style="margin-left:10px;vertical-align:bottom;">Close</a>';b+="</form>";$.modal(b,{containerCss:{backgroundColor:"#ffffff",borderColor:"#ffffff",height:"500px",width:"400px",padding:"10px"},onClose:function(a){a.data.fadeOut("400",function(){a.container.hide("400",function(){a.overlay.slideUp("fase",function(){$.modal.close()})})})}})}})};$(".delete").click(function(){return confirm("Are you sure you want to delete this location?")?true:false});$(".map_easy").live("click",function(){var d,c,e,b;d=$(this).data("lat");c=$(this).data("long");e=$(this).data("id");map.panTo(new google.maps.LatLng(d,c));for(i=0;i<locations.length;i++)if(locations[i].locationID===e){b=$.inArray(locations[i],locations);break}infoWindow&&infoWindow.close();infoWindow=new google.maps.InfoWindow({content:a(b)});infoWindow.open(map,markers[b])});$(".map_tough").live("click",function(){var a,c,b;a=$(this).data("address");geocoder.geocode({address:a},function(a,b){if(b===google.maps.GeocoderStatus.OK)map.panTo(a[0].geometry.location);else displayError("There was an error while processing your request.")})});$(".directions_easy").live("click",function(){var a=$(this).data("address");d(a)});$("#getDirections").live("click",function(){$.modal.close();var a,c,d,b,e;a=$("#destination").val();c=$("#directAddr").val();d=$("#city").val();b=$("#state").val();e={origin:c+" "+d+","+b,destination:a,travelMode:google.maps.TravelMode.DRIVING};directionsService.route(e,function(a,b){b===google.maps.DirectionsStatus.OK&&directionsDisplay.setDirections(a)});return false});$("span.send_email").live("click",function(c){c.preventDefault();var a=$(this).attr("data-email"),b=$("#content-container").html();$.modal(b,{containerCss:{backgroundColor:"#ffffff",borderColor:"#ffffff",height:"800px",width:"550px",padding:"10px"},onClose:function(a){if(modelClosingAction==="showThanks"){$("#simplemodal-overlay").remove();$("#simplemodal-container").remove();showThanks()}else a.data.fadeOut("400",function(){a.container.hide("400",function(){a.overlay.slideUp("fase",function(){$.modal.close()})})})}});$("div.simplemodal-container form.simple-form input#to").val(a);$("div.simplemodal-container form.simple-form input[type=submit]").css("display","inline-block").after('<a href="javascript:$.modal.close()" title="Close" style="margin-left:10px;vertical-align:bottom;">Close</a>');return false});locations=$.parseJSON($("#json").val());Modernizr.geolocation&&navigator.geolocation.getCurrentPosition(c);directionsDisplay=new google.maps.DirectionsRenderer;b("38","-97",4);geocoder=new google.maps.Geocoder});