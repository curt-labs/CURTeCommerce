(function(a){var c=a.browser.msie&&parseInt(a.browser.version)===6&&typeof window.XMLHttpRequest!=="object",e=a.browser.msie&&parseInt(a.browser.version)===7,d=null,b=[];a.modal=function(b,c){return a.modal.impl.init(b,c)};a.modal.close=function(){a.modal.impl.close()};a.modal.focus=function(b){a.modal.impl.focus(b)};a.modal.setContainerDimensions=function(){a.modal.impl.setContainerDimensions()};a.modal.setPosition=function(){a.modal.impl.setPosition()};a.modal.update=function(b,c){a.modal.impl.update(b,c)};a.fn.modal=function(b){return a.modal.impl.init(this,b)};a.modal.defaults={appendTo:"body",focus:true,opacity:50,overlayId:"simplemodal-overlay",overlayCss:{},containerId:"simplemodal-container",containerCss:{},dataId:"simplemodal-data",dataCss:{},minHeight:null,minWidth:null,maxHeight:null,maxWidth:null,autoResize:false,autoPosition:true,zIndex:1e3,close:true,closeHTML:'<a class="modalCloseImg" title="Close"></a>',closeClass:"simplemodal-close",escClose:true,overlayClose:false,position:null,persist:false,modal:true,onOpen:null,onShow:null,onClose:null};a.modal.impl={d:{},init:function(c,e){var b=this;if(b.d.data)return false;d=a.browser.msie&&!a.boxModel;b.o=a.extend({},a.modal.defaults,e);b.zIndex=b.o.zIndex;b.occb=false;if(typeof c==="object"){c=c instanceof jQuery?c:a(c);b.d.placeholder=false;if(c.parent().parent().size()>0){c.before(a("<span></span>").attr("id","simplemodal-placeholder").css({display:"none"}));b.d.placeholder=true;b.display=c.css("display");if(!b.o.persist)b.d.orig=c.clone(true)}}else if(typeof c==="string"||typeof c==="number")c=a("<div></div>").html(c);else{alert("SimpleModal Error: Unsupported data type: "+typeof c);return b}b.create(c);b.open();a.isFunction(b.o.onShow)&&b.o.onShow.apply(b,[b.d]);return b},create:function(f){var e=this;b=e.getDimensions();if(e.o.modal&&c)e.d.iframe=a('<iframe src="javascript:false;"></iframe>').css(a.extend(e.o.iframeCss,{display:"none",opacity:0,position:"fixed",height:b[0],width:b[1],zIndex:e.o.zIndex,top:0,left:0})).appendTo(e.o.appendTo);e.d.overlay=a("<div></div>").attr("id",e.o.overlayId).addClass("simplemodal-overlay").css(a.extend(e.o.overlayCss,{display:"none",opacity:e.o.opacity/100,height:e.o.modal?b[0]:0,width:e.o.modal?b[1]:0,position:"fixed",left:0,top:0,zIndex:e.o.zIndex+1})).appendTo(e.o.appendTo);e.d.container=a("<div></div>").attr("id",e.o.containerId).addClass("simplemodal-container").css(a.extend(e.o.containerCss,{display:"none",position:"fixed",zIndex:e.o.zIndex+2})).append(e.o.close&&e.o.closeHTML?a(e.o.closeHTML).addClass(e.o.closeClass):"").appendTo(e.o.appendTo);e.d.wrap=a("<div></div>").attr("tabIndex",-1).addClass("simplemodal-wrap").css({height:"100%",outline:0,width:"100%"}).appendTo(e.d.container);e.d.data=f.attr("id",f.attr("id")||e.o.dataId).addClass("simplemodal-data").css(a.extend(e.o.dataCss,{display:"none"})).appendTo("body");e.setContainerDimensions();e.d.data.appendTo(e.d.wrap);(c||d)&&e.fixIE()},bindEvents:function(){var e=this;a("."+e.o.closeClass).bind("click.simplemodal",function(a){a.preventDefault();e.close()});e.o.modal&&e.o.close&&e.o.overlayClose&&e.d.overlay.bind("click.simplemodal",function(a){a.preventDefault();e.close()});a(document).bind("keydown.simplemodal",function(a){if(e.o.modal&&a.keyCode===9)e.watchTab(a);else if(e.o.close&&e.o.escClose&&a.keyCode===27){a.preventDefault();e.close()}});a(window).bind("resize.simplemodal",function(){b=e.getDimensions();e.o.autoResize?e.setContainerDimensions():e.o.autoPosition&&e.setPosition();if(c||d)e.fixIE();else if(e.o.modal){e.d.iframe&&e.d.iframe.css({height:b[0],width:b[1]});e.d.overlay.css({height:b[0],width:b[1]})}})},unbindEvents:function(){a("."+this.o.closeClass).unbind("click.simplemodal");a(document).unbind("keydown.simplemodal");a(window).unbind("resize.simplemodal");this.d.overlay.unbind("click.simplemodal")},fixIE:function(){var c=this,b=c.o.position;a.each([c.d.iframe||null,!c.o.modal?null:c.d.overlay,c.d.container],function(c,e){if(e){var a=e[0].style;a.position="absolute";if(c<2){a.removeExpression("height");a.removeExpression("width");a.setExpression("height",'document.body.scrollHeight > document.body.clientHeight ? document.body.scrollHeight : document.body.clientHeight + "px"');a.setExpression("width",'document.body.scrollWidth > document.body.clientWidth ? document.body.scrollWidth : document.body.clientWidth + "px"')}else{var d;if(b&&b.constructor===Array){c=b[0]?typeof b[0]==="number"?b[0].toString():b[0].replace(/px/,""):e.css("top").replace(/px/,"");c=c.indexOf("%")===-1?c+' + (t = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "px"':parseInt(c.replace(/%/,""))+' * ((document.documentElement.clientHeight || document.body.clientHeight) / 100) + (t = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "px"';if(b[1]){d=typeof b[1]==="number"?b[1].toString():b[1].replace(/px/,"");d=d.indexOf("%")===-1?d+' + (t = document.documentElement.scrollLeft ? document.documentElement.scrollLeft : document.body.scrollLeft) + "px"':parseInt(d.replace(/%/,""))+' * ((document.documentElement.clientWidth || document.body.clientWidth) / 100) + (t = document.documentElement.scrollLeft ? document.documentElement.scrollLeft : document.body.scrollLeft) + "px"'}}else{c='(document.documentElement.clientHeight || document.body.clientHeight) / 2 - (this.offsetHeight / 2) + (t = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "px"';d='(document.documentElement.clientWidth || document.body.clientWidth) / 2 - (this.offsetWidth / 2) + (t = document.documentElement.scrollLeft ? document.documentElement.scrollLeft : document.body.scrollLeft) + "px"'}a.removeExpression("top");a.removeExpression("left");a.setExpression("top",c);a.setExpression("left",d)}}})},focus:function(b){var c=this;b=b&&a.inArray(b,["first","last"])!==-1?b:"first";var d=a(":input:enabled:visible:"+b,c.d.wrap);setTimeout(function(){d.length>0?d.focus():c.d.wrap.focus()},10)},getDimensions:function(){var b=a(window);return[a.browser.opera&&a.browser.version>"9.5"&&a.fn.jquery<"1.3"||a.browser.opera&&a.browser.version<"9.5"&&a.fn.jquery>"1.2.6"?b[0].innerHeight:b.height(),b.width()]},getVal:function(a,c){return a?typeof a==="number"?a:a==="auto"?0:a.indexOf("%")>0?parseInt(a.replace(/%/,""))/100*(c==="h"?b[0]:b[1]):parseInt(a.replace(/px/,"")):null},update:function(b,c){var a=this;if(!a.d.data)return false;a.d.origHeight=a.getVal(b,"h");a.d.origWidth=a.getVal(c,"w");a.d.data.hide();b&&a.d.container.css("height",b);c&&a.d.container.css("width",c);a.setContainerDimensions();a.d.data.show();a.o.focus&&a.focus();a.unbindEvents();a.bindEvents()},setContainerDimensions:function(){var d=this,g=c||e,h=d.d.origHeight?d.d.origHeight:a.browser.opera?d.d.container.height():d.getVal(g?d.d.container[0].currentStyle.height:d.d.container.css("height"),"h");g=d.d.origWidth?d.d.origWidth:a.browser.opera?d.d.container.width():d.getVal(g?d.d.container[0].currentStyle.width:d.d.container.css("width"),"w");var l=d.d.data.outerHeight(true),k=d.d.data.outerWidth(true);d.d.origHeight=d.d.origHeight||h;d.d.origWidth=d.d.origWidth||g;var f=d.o.maxHeight?d.getVal(d.o.maxHeight,"h"):null,i=d.o.maxWidth?d.getVal(d.o.maxWidth,"w"):null;f=f&&f<b[0]?f:b[0];i=i&&i<b[1]?i:b[1];var j=d.o.minHeight?d.getVal(d.o.minHeight,"h"):"auto";h=h?d.o.autoResize&&h>f?f:h<j?j:h:l?l>f?f:d.o.minHeight&&j!=="auto"&&l<j?j:l:j;f=d.o.minWidth?d.getVal(d.o.minWidth,"w"):"auto";g=g?d.o.autoResize&&g>i?i:g<f?f:g:k?k>i?i:d.o.minWidth&&f!=="auto"&&k<f?f:k:f;d.d.container.css({height:h,width:g});d.d.wrap.css({overflow:l>h||k>g?"auto":"visible"});d.o.autoPosition&&d.setPosition()},setPosition:function(){var a=this,c,d;c=b[0]/2-a.d.container.outerHeight(true)/2;d=b[1]/2-a.d.container.outerWidth(true)/2;if(a.o.position&&Object.prototype.toString.call(a.o.position)==="[object Array]"){c=a.o.position[0]||c;d=a.o.position[1]||d}else{c=c;d=d}a.d.container.css({left:d,top:c})},watchTab:function(b){var c=this;if(a(b.target).parents(".simplemodal-container").length>0){c.inputs=a(":input:enabled:visible:first, :input:enabled:visible:last",c.d.data[0]);if(!b.shiftKey&&b.target===c.inputs[c.inputs.length-1]||b.shiftKey&&b.target===c.inputs[0]||c.inputs.length===0){b.preventDefault();c.focus(b.shiftKey?"last":"first")}}else{b.preventDefault();c.focus()}},open:function(){var b=this;b.d.iframe&&b.d.iframe.show();if(a.isFunction(b.o.onOpen))b.o.onOpen.apply(b,[b.d]);else{b.d.overlay.show();b.d.container.show();b.d.data.show()}b.o.focus&&b.focus();b.bindEvents()},close:function(){var b=this;if(!b.d.data)return false;b.unbindEvents();if(a.isFunction(b.o.onClose)&&!b.occb){b.occb=true;b.o.onClose.apply(b,[b.d])}else{if(b.d.placeholder){var c=a("#simplemodal-placeholder");if(b.o.persist)c.replaceWith(b.d.data.removeClass("simplemodal-data").css("display",b.display));else{b.d.data.hide().remove();c.replaceWith(b.d.orig)}}else b.d.data.hide().remove();b.d.container.hide().remove();b.d.overlay.hide();b.d.iframe&&b.d.iframe.hide().remove();setTimeout(function(){b.d.overlay.remove();b.d={}},10)}}}})(jQuery);